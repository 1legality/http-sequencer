(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const e of n)if(e.type==="childList")for(const t of e.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&s(t)}).observe(document,{childList:!0,subtree:!0});function l(n){const e={};return n.integrity&&(e.integrity=n.integrity),n.referrerPolicy&&(e.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?e.credentials="include":n.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function s(n){if(n.ep)return;n.ep=!0;const e=l(n);fetch(n.href,e)}})();function be(a){if(Object.prototype.hasOwnProperty.call(a,"__esModule"))return a;var h=a.default;if(typeof h=="function"){var l=function s(){var n=!1;try{n=this instanceof s}catch{}return n?Reflect.construct(h,arguments,this.constructor):h.apply(this,arguments)};l.prototype=h.prototype}else l={};return Object.defineProperty(l,"__esModule",{value:!0}),Object.keys(a).forEach(function(s){var n=Object.getOwnPropertyDescriptor(a,s);Object.defineProperty(l,s,n.get?n:{enumerable:!0,get:function(){return a[s]}})}),l}var O={},A={},L,X;function ge(){if(X)return L;X=1;function a(n){var e=new s(n),t=e.readChunk();if(t.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+t.id+"'";for(var u=h(t.data),o=[],i=0;!e.eof()&&i<u.numTracks;i++){var r=e.readChunk();if(r.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+r.id+"'";var c=l(r.data);o.push(c)}return{header:u,tracks:o}}function h(n){var e=new s(n),t=e.readUInt16(),u=e.readUInt16(),o={format:t,numTracks:u},i=e.readUInt16();return i&32768?(o.framesPerSecond=256-(i>>8),o.ticksPerFrame=i&255):o.ticksPerBeat=i,o}function l(n){for(var e=new s(n),t=[];!e.eof();){var u=i();t.push(u)}return t;var o;function i(){var r={};r.deltaTime=e.readVarInt();var c=e.readUInt8();if((c&240)===240)if(c===255){r.meta=!0;var m=e.readUInt8(),f=e.readVarInt();switch(m){case 0:if(r.type="sequenceNumber",f!==2)throw"Expected length for sequenceNumber event is 2, got "+f;return r.number=e.readUInt16(),r;case 1:return r.type="text",r.text=e.readString(f),r;case 2:return r.type="copyrightNotice",r.text=e.readString(f),r;case 3:return r.type="trackName",r.text=e.readString(f),r;case 4:return r.type="instrumentName",r.text=e.readString(f),r;case 5:return r.type="lyrics",r.text=e.readString(f),r;case 6:return r.type="marker",r.text=e.readString(f),r;case 7:return r.type="cuePoint",r.text=e.readString(f),r;case 32:if(r.type="channelPrefix",f!=1)throw"Expected length for channelPrefix event is 1, got "+f;return r.channel=e.readUInt8(),r;case 33:if(r.type="portPrefix",f!=1)throw"Expected length for portPrefix event is 1, got "+f;return r.port=e.readUInt8(),r;case 47:if(r.type="endOfTrack",f!=0)throw"Expected length for endOfTrack event is 0, got "+f;return r;case 81:if(r.type="setTempo",f!=3)throw"Expected length for setTempo event is 3, got "+f;return r.microsecondsPerBeat=e.readUInt24(),r;case 84:if(r.type="smpteOffset",f!=5)throw"Expected length for smpteOffset event is 5, got "+f;var k=e.readUInt8(),b={0:24,32:25,64:29,96:30};return r.frameRate=b[k&96],r.hour=k&31,r.min=e.readUInt8(),r.sec=e.readUInt8(),r.frame=e.readUInt8(),r.subFrame=e.readUInt8(),r;case 88:if(r.type="timeSignature",f!=2&&f!=4)throw"Expected length for timeSignature event is 4 or 2, got "+f;return r.numerator=e.readUInt8(),r.denominator=1<<e.readUInt8(),f===4?(r.metronome=e.readUInt8(),r.thirtyseconds=e.readUInt8()):(r.metronome=36,r.thirtyseconds=8),r;case 89:if(r.type="keySignature",f!=2)throw"Expected length for keySignature event is 2, got "+f;return r.key=e.readInt8(),r.scale=e.readUInt8(),r;case 127:return r.type="sequencerSpecific",r.data=e.readBytes(f),r;default:return r.type="unknownMeta",r.data=e.readBytes(f),r.metatypeByte=m,r}}else if(c==240){r.type="sysEx";var f=e.readVarInt();return r.data=e.readBytes(f),r}else if(c==247){r.type="endSysEx";var f=e.readVarInt();return r.data=e.readBytes(f),r}else throw"Unrecognised MIDI event type byte: "+c;else{var y;if((c&128)===0){if(o===null)throw"Running status byte encountered before status byte";y=c,c=o,r.running=!0}else y=e.readUInt8(),o=c;var d=c>>4;switch(r.channel=c&15,d){case 8:return r.type="noteOff",r.noteNumber=y,r.velocity=e.readUInt8(),r;case 9:var g=e.readUInt8();return r.type=g===0?"noteOff":"noteOn",r.noteNumber=y,r.velocity=g,g===0&&(r.byte9=!0),r;case 10:return r.type="noteAftertouch",r.noteNumber=y,r.amount=e.readUInt8(),r;case 11:return r.type="controller",r.controllerType=y,r.value=e.readUInt8(),r;case 12:return r.type="programChange",r.programNumber=y,r;case 13:return r.type="channelAftertouch",r.amount=y,r;case 14:return r.type="pitchBend",r.value=y+(e.readUInt8()<<7)-8192,r;default:throw"Unrecognised MIDI event type: "+d}}}}function s(n){this.buffer=n,this.bufferLen=this.buffer.length,this.pos=0}return s.prototype.eof=function(){return this.pos>=this.bufferLen},s.prototype.readUInt8=function(){var n=this.buffer[this.pos];return this.pos+=1,n},s.prototype.readInt8=function(){var n=this.readUInt8();return n&128?n-256:n},s.prototype.readUInt16=function(){var n=this.readUInt8(),e=this.readUInt8();return(n<<8)+e},s.prototype.readInt16=function(){var n=this.readUInt16();return n&32768?n-65536:n},s.prototype.readUInt24=function(){var n=this.readUInt8(),e=this.readUInt8(),t=this.readUInt8();return(n<<16)+(e<<8)+t},s.prototype.readInt24=function(){var n=this.readUInt24();return n&8388608?n-16777216:n},s.prototype.readUInt32=function(){var n=this.readUInt8(),e=this.readUInt8(),t=this.readUInt8(),u=this.readUInt8();return(n<<24)+(e<<16)+(t<<8)+u},s.prototype.readBytes=function(n){var e=this.buffer.slice(this.pos,this.pos+n);return this.pos+=n,e},s.prototype.readString=function(n){var e=this.readBytes(n);return String.fromCharCode.apply(null,e)},s.prototype.readVarInt=function(){for(var n=0;!this.eof();){var e=this.readUInt8();if(e&128)n+=e&127,n<<=7;else return n+e}return n},s.prototype.readChunk=function(){var n=this.readString(4),e=this.readUInt32(),t=this.readBytes(e);return{id:n,length:e,data:t}},L=a,L}var J,Y;function ve(){if(Y)return J;Y=1;function a(e,t){if(typeof e!="object")throw"Invalid MIDI data";t=t||{};var u=e.header||{},o=e.tracks||[],i,r=o.length,c=new n;for(h(c,u,r),i=0;i<r;i++)l(c,o[i],t);return c.buffer}function h(e,t,u){var o=t.format==null?1:t.format,i=128;t.timeDivision?i=t.timeDivision:t.ticksPerFrame&&t.framesPerSecond?i=-(t.framesPerSecond&255)<<8|t.ticksPerFrame&255:t.ticksPerBeat&&(i=t.ticksPerBeat&32767);var r=new n;r.writeUInt16(o),r.writeUInt16(u),r.writeUInt16(i),e.writeChunk("MThd",r.buffer)}function l(e,t,u){var o=new n,i,r=t.length,c=null;for(i=0;i<r;i++)(u.running===!1||!u.running&&!t[i].running)&&(c=null),c=s(o,t[i],c,u.useByte9ForNoteOff);e.writeChunk("MTrk",o.buffer)}function s(e,t,u,o){var i=t.type,r=t.deltaTime,c=t.text||"",m=t.data||[],f=null;switch(e.writeVarInt(r),i){case"sequenceNumber":e.writeUInt8(255),e.writeUInt8(0),e.writeVarInt(2),e.writeUInt16(t.number);break;case"text":e.writeUInt8(255),e.writeUInt8(1),e.writeVarInt(c.length),e.writeString(c);break;case"copyrightNotice":e.writeUInt8(255),e.writeUInt8(2),e.writeVarInt(c.length),e.writeString(c);break;case"trackName":e.writeUInt8(255),e.writeUInt8(3),e.writeVarInt(c.length),e.writeString(c);break;case"instrumentName":e.writeUInt8(255),e.writeUInt8(4),e.writeVarInt(c.length),e.writeString(c);break;case"lyrics":e.writeUInt8(255),e.writeUInt8(5),e.writeVarInt(c.length),e.writeString(c);break;case"marker":e.writeUInt8(255),e.writeUInt8(6),e.writeVarInt(c.length),e.writeString(c);break;case"cuePoint":e.writeUInt8(255),e.writeUInt8(7),e.writeVarInt(c.length),e.writeString(c);break;case"channelPrefix":e.writeUInt8(255),e.writeUInt8(32),e.writeVarInt(1),e.writeUInt8(t.channel);break;case"portPrefix":e.writeUInt8(255),e.writeUInt8(33),e.writeVarInt(1),e.writeUInt8(t.port);break;case"endOfTrack":e.writeUInt8(255),e.writeUInt8(47),e.writeVarInt(0);break;case"setTempo":e.writeUInt8(255),e.writeUInt8(81),e.writeVarInt(3),e.writeUInt24(t.microsecondsPerBeat);break;case"smpteOffset":e.writeUInt8(255),e.writeUInt8(84),e.writeVarInt(5);var k={24:0,25:32,29:64,30:96},b=t.hour&31|k[t.frameRate];e.writeUInt8(b),e.writeUInt8(t.min),e.writeUInt8(t.sec),e.writeUInt8(t.frame),e.writeUInt8(t.subFrame);break;case"timeSignature":e.writeUInt8(255),e.writeUInt8(88),e.writeVarInt(4),e.writeUInt8(t.numerator);var y=Math.floor(Math.log(t.denominator)/Math.LN2)&255;e.writeUInt8(y),e.writeUInt8(t.metronome),e.writeUInt8(t.thirtyseconds||8);break;case"keySignature":e.writeUInt8(255),e.writeUInt8(89),e.writeVarInt(2),e.writeInt8(t.key),e.writeUInt8(t.scale);break;case"sequencerSpecific":e.writeUInt8(255),e.writeUInt8(127),e.writeVarInt(m.length),e.writeBytes(m);break;case"unknownMeta":t.metatypeByte!=null&&(e.writeUInt8(255),e.writeUInt8(t.metatypeByte),e.writeVarInt(m.length),e.writeBytes(m));break;case"sysEx":e.writeUInt8(240),e.writeVarInt(m.length),e.writeBytes(m);break;case"endSysEx":e.writeUInt8(247),e.writeVarInt(m.length),e.writeBytes(m);break;case"noteOff":var d=o!==!1&&t.byte9||o&&t.velocity==0?144:128;f=d|t.channel,f!==u&&e.writeUInt8(f),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteOn":f=144|t.channel,f!==u&&e.writeUInt8(f),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteAftertouch":f=160|t.channel,f!==u&&e.writeUInt8(f),e.writeUInt8(t.noteNumber),e.writeUInt8(t.amount);break;case"controller":f=176|t.channel,f!==u&&e.writeUInt8(f),e.writeUInt8(t.controllerType),e.writeUInt8(t.value);break;case"programChange":f=192|t.channel,f!==u&&e.writeUInt8(f),e.writeUInt8(t.programNumber);break;case"channelAftertouch":f=208|t.channel,f!==u&&e.writeUInt8(f),e.writeUInt8(t.amount);break;case"pitchBend":f=224|t.channel,f!==u&&e.writeUInt8(f);var g=8192+t.value,v=g&127,p=g>>7&127;e.writeUInt8(v),e.writeUInt8(p);break;default:throw"Unrecognized event type: "+i}return f}function n(){this.buffer=[]}return n.prototype.writeUInt8=function(e){this.buffer.push(e&255)},n.prototype.writeInt8=n.prototype.writeUInt8,n.prototype.writeUInt16=function(e){var t=e>>8&255,u=e&255;this.writeUInt8(t),this.writeUInt8(u)},n.prototype.writeInt16=n.prototype.writeUInt16,n.prototype.writeUInt24=function(e){var t=e>>16&255,u=e>>8&255,o=e&255;this.writeUInt8(t),this.writeUInt8(u),this.writeUInt8(o)},n.prototype.writeInt24=n.prototype.writeUInt24,n.prototype.writeUInt32=function(e){var t=e>>24&255,u=e>>16&255,o=e>>8&255,i=e&255;this.writeUInt8(t),this.writeUInt8(u),this.writeUInt8(o),this.writeUInt8(i)},n.prototype.writeInt32=n.prototype.writeUInt32,n.prototype.writeBytes=function(e){this.buffer=this.buffer.concat(Array.prototype.slice.call(e,0))},n.prototype.writeString=function(e){var t,u=e.length,o=[];for(t=0;t<u;t++)o.push(e.codePointAt(t));this.writeBytes(o)},n.prototype.writeVarInt=function(e){if(e<0)throw"Cannot write negative variable-length integer";if(e<=127)this.writeUInt8(e);else{var t=e,u=[];for(u.push(t&127),t>>=7;t;){var o=t&127|128;u.push(o),t>>=7}this.writeBytes(u.reverse())}},n.prototype.writeChunk=function(e,t){this.writeString(e),this.writeUInt32(t.length),this.writeBytes(t)},J=a,J}var Z;function de(){return Z||(Z=1,A.parseMidi=ge(),A.writeMidi=ve()),A}var R={},S={},ee;function me(){if(ee)return S;ee=1,Object.defineProperty(S,"__esModule",{value:!0}),S.insert=S.search=void 0;function a(l,s,n){n===void 0&&(n="ticks");var e=0,t=l.length,u=t;if(t>0&&l[t-1][n]<=s)return t-1;for(;e<u;){var o=Math.floor(e+(u-e)/2),i=l[o],r=l[o+1];if(i[n]===s){for(var c=o;c<l.length;c++){var m=l[c];m[n]===s&&(o=c)}return o}else{if(i[n]<s&&r[n]>s)return o;i[n]>s?u=o:i[n]<s&&(e=o+1)}}return-1}S.search=a;function h(l,s,n){if(n===void 0&&(n="ticks"),l.length){var e=a(l,s[n],n);l.splice(e+1,0,s)}else l.push(s)}return S.insert=h,S}var te;function z(){return te||(te=1,(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.Header=a.keySignatureKeys=void 0;var h=me(),l=new WeakMap;a.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var s=(function(){function n(e){var t=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",l.set(this,480),e){l.set(this,e.header.ticksPerBeat),e.tracks.forEach(function(o){o.forEach(function(i){i.meta&&(i.type==="timeSignature"?t.timeSignatures.push({ticks:i.absoluteTime,timeSignature:[i.numerator,i.denominator]}):i.type==="setTempo"?t.tempos.push({bpm:6e7/i.microsecondsPerBeat,ticks:i.absoluteTime}):i.type==="keySignature"&&t.keySignatures.push({key:a.keySignatureKeys[i.key+7],scale:i.scale===0?"major":"minor",ticks:i.absoluteTime}))})});var u=0;e.tracks[0].forEach(function(o){u+=o.deltaTime,o.meta&&(o.type==="trackName"?t.name=o.text:(o.type==="text"||o.type==="cuePoint"||o.type==="marker"||o.type==="lyrics")&&t.meta.push({text:o.text,ticks:u,type:o.type}))}),this.update()}}return n.prototype.update=function(){var e=this,t=0,u=0;this.tempos.sort(function(o,i){return o.ticks-i.ticks}),this.tempos.forEach(function(o,i){var r=i>0?e.tempos[i-1].bpm:e.tempos[0].bpm,c=o.ticks/e.ppq-u,m=60/r*c;o.time=m+t,t=o.time,u+=c}),this.timeSignatures.sort(function(o,i){return o.ticks-i.ticks}),this.timeSignatures.forEach(function(o,i){var r=i>0?e.timeSignatures[i-1]:e.timeSignatures[0],c=(o.ticks-r.ticks)/e.ppq,m=c/r.timeSignature[0]/(r.timeSignature[1]/4);r.measures=r.measures||0,o.measures=m+r.measures})},n.prototype.ticksToSeconds=function(e){var t=(0,h.search)(this.tempos,e);if(t!==-1){var u=this.tempos[t],o=u.time,i=(e-u.ticks)/this.ppq;return o+60/u.bpm*i}else{var r=e/this.ppq;return 60/120*r}},n.prototype.ticksToMeasures=function(e){var t=(0,h.search)(this.timeSignatures,e);if(t!==-1){var u=this.timeSignatures[t],o=(e-u.ticks)/this.ppq;return u.measures+o/(u.timeSignature[0]/u.timeSignature[1])/4}else return e/this.ppq/4},Object.defineProperty(n.prototype,"ppq",{get:function(){return l.get(this)},enumerable:!1,configurable:!0}),n.prototype.secondsToTicks=function(e){var t=(0,h.search)(this.tempos,e,"time");if(t!==-1){var u=this.tempos[t],o=u.time,i=e-o,r=i/(60/u.bpm);return Math.round(u.ticks+r*this.ppq)}else{var c=e/.5;return Math.round(c*this.ppq)}},n.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(e){return{bpm:e.bpm,ticks:e.ticks}}),timeSignatures:this.timeSignatures}},n.prototype.fromJSON=function(e){this.name=e.name,this.tempos=e.tempos.map(function(t){return Object.assign({},t)}),this.timeSignatures=e.timeSignatures.map(function(t){return Object.assign({},t)}),this.keySignatures=e.keySignatures.map(function(t){return Object.assign({},t)}),this.meta=e.meta.map(function(t){return Object.assign({},t)}),l.set(this,e.ppq),this.update()},n.prototype.setTempo=function(e){this.tempos=[{bpm:e,ticks:0}],this.update()},n})();a.Header=s})(R)),R}var N={},W={},re;function pe(){return re||(re=1,(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.ControlChange=a.controlChangeIds=a.controlChangeNames=void 0,a.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},a.controlChangeIds=Object.keys(a.controlChangeNames).reduce(function(n,e){return n[a.controlChangeNames[e]]=e,n},{});var h=new WeakMap,l=new WeakMap,s=(function(){function n(e,t){h.set(this,t),l.set(this,e.controllerType),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(n.prototype,"number",{get:function(){return l.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return a.controlChangeNames[this.number]?a.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"time",{get:function(){var e=h.get(this);return e.ticksToSeconds(this.ticks)},set:function(e){var t=h.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},n})();a.ControlChange=s})(W)),W}var E={},ne;function ke(){if(ne)return E;ne=1,Object.defineProperty(E,"__esModule",{value:!0}),E.createControlChanges=void 0;var a=pe();function h(){return new Proxy({},{get:function(l,s){if(l[s])return l[s];if(a.controlChangeIds.hasOwnProperty(s))return l[a.controlChangeIds[s]]},set:function(l,s,n){return a.controlChangeIds.hasOwnProperty(s)?l[a.controlChangeIds[s]]=n:l[s]=n,!0}})}return E.createControlChanges=h,E}var _={},ie;function Ie(){if(ie)return _;ie=1,Object.defineProperty(_,"__esModule",{value:!0}),_.PitchBend=void 0;var a=new WeakMap,h=(function(){function l(s,n){a.set(this,n),this.ticks=s.absoluteTime,this.value=s.value}return Object.defineProperty(l.prototype,"time",{get:function(){var s=a.get(this);return s.ticksToSeconds(this.ticks)},set:function(s){var n=a.get(this);this.ticks=n.secondsToTicks(s)},enumerable:!1,configurable:!0}),l.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},l})();return _.PitchBend=h,_}var q={},U={},ae;function xe(){return ae||(ae=1,Object.defineProperty(U,"__esModule",{value:!0}),U.DrumKitByPatchID=U.InstrumentFamilyByID=U.instrumentByPatchID=void 0,U.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],U.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],U.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}),U}var se;function we(){if(se)return q;se=1,Object.defineProperty(q,"__esModule",{value:!0}),q.Instrument=void 0;var a=xe(),h=new WeakMap,l=(function(){function s(n,e){if(this.number=0,h.set(this,e),this.number=0,n){var t=n.find(function(u){return u.type==="programChange"});t&&(this.number=t.programNumber)}}return Object.defineProperty(s.prototype,"name",{get:function(){return this.percussion?a.DrumKitByPatchID[this.number]:a.instrumentByPatchID[this.number]},set:function(n){var e=a.instrumentByPatchID.indexOf(n);e!==-1&&(this.number=e)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"family",{get:function(){return this.percussion?"drums":a.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"percussion",{get:function(){var n=h.get(this);return n.channel===9},enumerable:!1,configurable:!0}),s.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},s.prototype.fromJSON=function(n){this.number=n.number},s})();return q.Instrument=l,q}var j={},oe;function Te(){if(oe)return j;oe=1,Object.defineProperty(j,"__esModule",{value:!0}),j.Note=void 0;function a(t){var u=Math.floor(t/12)-1;return h(t)+u.toString()}function h(t){var u=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],o=t%12;return u[o]}function l(t){var u=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return u.indexOf(t)}var s=(function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,u={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(o){var i=t.exec(o),r=i[1],c=i[2],m=u[r.toLowerCase()];return m+(parseInt(c,10)+1)*12}})(),n=new WeakMap,e=(function(){function t(u,o,i){n.set(this,i),this.midi=u.midi,this.velocity=u.velocity,this.noteOffVelocity=o.velocity,this.ticks=u.ticks,this.durationTicks=o.ticks-u.ticks}return Object.defineProperty(t.prototype,"name",{get:function(){return a(this.midi)},set:function(u){this.midi=s(u)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(u){var o=u-this.octave;this.midi+=o*12},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return h(this.midi)},set:function(u){this.midi=12*(this.octave+1)+l(u)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var u=n.get(this);return u.ticksToSeconds(this.ticks+this.durationTicks)-u.ticksToSeconds(this.ticks)},set:function(u){var o=n.get(this),i=o.secondsToTicks(this.time+u);this.durationTicks=i-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){var u=n.get(this);return u.ticksToSeconds(this.ticks)},set:function(u){var o=n.get(this);this.ticks=o.secondsToTicks(u)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bars",{get:function(){var u=n.get(this);return u.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},t})();return j.Note=e,j}var ue;function ce(){if(ue)return N;ue=1,Object.defineProperty(N,"__esModule",{value:!0}),N.Track=void 0;var a=me(),h=pe(),l=ke(),s=Ie(),n=we(),e=Te(),t=new WeakMap,u=(function(){function o(i,r){var c=this;if(this.name="",this.notes=[],this.controlChanges=(0,l.createControlChanges)(),this.pitchBends=[],t.set(this,r),i){var m=i.find(function(p){return p.type==="trackName"});this.name=m?m.text:""}if(this.instrument=new n.Instrument(i,this),this.channel=0,i){for(var f=i.filter(function(p){return p.type==="noteOn"}),k=i.filter(function(p){return p.type==="noteOff"}),b=function(){var p=f.shift();y.channel=p.channel;var I=k.findIndex(function(F){return F.noteNumber===p.noteNumber&&F.absoluteTime>=p.absoluteTime});if(I!==-1){var x=k.splice(I,1)[0];y.addNote({durationTicks:x.absoluteTime-p.absoluteTime,midi:p.noteNumber,noteOffVelocity:x.velocity/127,ticks:p.absoluteTime,velocity:p.velocity/127})}},y=this;f.length;)b();var d=i.filter(function(p){return p.type==="controller"});d.forEach(function(p){c.addCC({number:p.controllerType,ticks:p.absoluteTime,value:p.value/127})});var g=i.filter(function(p){return p.type==="pitchBend"});g.forEach(function(p){c.addPitchBend({ticks:p.absoluteTime,value:p.value/Math.pow(2,13)})});var v=i.find(function(p){return p.type==="endOfTrack"});this.endOfTrackTicks=v!==void 0?v.absoluteTime:void 0}}return o.prototype.addNote=function(i){var r=t.get(this),c=new e.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},r);return Object.assign(c,i),(0,a.insert)(this.notes,c,"ticks"),this},o.prototype.addCC=function(i){var r=t.get(this),c=new h.ControlChange({controllerType:i.number},r);return delete i.number,Object.assign(c,i),Array.isArray(this.controlChanges[c.number])||(this.controlChanges[c.number]=[]),(0,a.insert)(this.controlChanges[c.number],c,"ticks"),this},o.prototype.addPitchBend=function(i){var r=t.get(this),c=new s.PitchBend({},r);return Object.assign(c,i),(0,a.insert)(this.pitchBends,c,"ticks"),this},Object.defineProperty(o.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var i=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,r=0;r<this.notes.length-1;r++){var c=this.notes[r].time+this.notes[r].duration;i<c&&(i=c)}return i},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var i=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,r=0;r<this.notes.length-1;r++){var c=this.notes[r].ticks+this.notes[r].durationTicks;i<c&&(i=c)}return i},enumerable:!1,configurable:!0}),o.prototype.fromJSON=function(i){var r=this;this.name=i.name,this.channel=i.channel,this.instrument=new n.Instrument(void 0,this),this.instrument.fromJSON(i.instrument),i.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=i.endOfTrackTicks);for(var c in i.controlChanges)i.controlChanges[c]&&i.controlChanges[c].forEach(function(m){r.addCC({number:m.number,ticks:m.ticks,value:m.value})});i.notes.forEach(function(m){r.addNote({durationTicks:m.durationTicks,midi:m.midi,ticks:m.ticks,velocity:m.velocity})})},o.prototype.toJSON=function(){for(var i={},r=0;r<127;r++)this.controlChanges.hasOwnProperty(r)&&(i[r]=this.controlChanges[r].map(function(m){return m.toJSON()}));var c={channel:this.channel,controlChanges:i,pitchBends:this.pitchBends.map(function(m){return m.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(m){return m.toJSON()})};return this.endOfTrackTicks!==void 0&&(c.endOfTrackTicks=this.endOfTrackTicks),c},o})();return N.Track=u,N}var C={};function Ue(a){var h=[];return ye(a,h),h}function ye(a,h){for(var l=0;l<a.length;l++){var s=a[l];Array.isArray(s)?ye(s,h):h.push(s)}}const Me=Object.freeze(Object.defineProperty({__proto__:null,flatten:Ue},Symbol.toStringTag,{value:"Module"})),Oe=be(Me);var fe;function Se(){if(fe)return C;fe=1;var a=C&&C.__spreadArray||function(d,g,v){if(v||arguments.length===2)for(var p=0,I=g.length,x;p<I;p++)(x||!(p in g))&&(x||(x=Array.prototype.slice.call(g,0,p)),x[p]=g[p]);return d.concat(x||Array.prototype.slice.call(g))};Object.defineProperty(C,"__esModule",{value:!0}),C.encode=void 0;var h=de(),l=z(),s=Oe;function n(d,g){return[{absoluteTime:d.ticks,channel:g,deltaTime:0,noteNumber:d.midi,type:"noteOn",velocity:Math.floor(d.velocity*127)},{absoluteTime:d.ticks+d.durationTicks,channel:g,deltaTime:0,noteNumber:d.midi,type:"noteOff",velocity:Math.floor(d.noteOffVelocity*127)}]}function e(d){return(0,s.flatten)(d.notes.map(function(g){return n(g,d.channel)}))}function t(d,g){return{absoluteTime:d.ticks,channel:g,controllerType:d.number,deltaTime:0,type:"controller",value:Math.floor(d.value*127)}}function u(d){for(var g=[],v=0;v<127;v++)d.controlChanges.hasOwnProperty(v)&&d.controlChanges[v].forEach(function(p){g.push(t(p,d.channel))});return g}function o(d,g){return{absoluteTime:d.ticks,channel:g,deltaTime:0,type:"pitchBend",value:d.value}}function i(d){var g=[];return d.pitchBends.forEach(function(v){g.push(o(v,d.channel))}),g}function r(d){return{absoluteTime:0,channel:d.channel,deltaTime:0,programNumber:d.instrument.number,type:"programChange"}}function c(d){return{absoluteTime:0,deltaTime:0,meta:!0,text:d,type:"trackName"}}function m(d){return{absoluteTime:d.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/d.bpm),type:"setTempo"}}function f(d){return{absoluteTime:d.ticks,deltaTime:0,denominator:d.timeSignature[1],meta:!0,metronome:24,numerator:d.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function k(d){var g=l.keySignatureKeys.indexOf(d.key);return{absoluteTime:d.ticks,deltaTime:0,key:g+7,meta:!0,scale:d.scale==="major"?0:1,type:"keySignature"}}function b(d){return{absoluteTime:d.ticks,deltaTime:0,meta:!0,text:d.text,type:d.type}}function y(d){var g={header:{format:1,numTracks:d.tracks.length+1,ticksPerBeat:d.header.ppq},tracks:a([a(a(a(a([{absoluteTime:0,deltaTime:0,meta:!0,text:d.header.name,type:"trackName"}],d.header.keySignatures.map(function(v){return k(v)}),!0),d.header.meta.map(function(v){return b(v)}),!0),d.header.tempos.map(function(v){return m(v)}),!0),d.header.timeSignatures.map(function(v){return f(v)}),!0)],d.tracks.map(function(v){return a(a(a([c(v.name),r(v)],e(v),!0),u(v),!0),i(v),!0)}),!0)};return g.tracks=g.tracks.map(function(v){v=v.sort(function(I,x){return I.absoluteTime-x.absoluteTime});var p=0;return v.forEach(function(I){I.deltaTime=I.absoluteTime-p,p=I.absoluteTime,delete I.absoluteTime}),v.push({deltaTime:0,meta:!0,type:"endOfTrack"}),v}),new Uint8Array((0,h.writeMidi)(g))}return C.encode=y,C}var le;function Ce(){return le||(le=1,(function(a){var h=O&&O.__awaiter||function(c,m,f,k){function b(y){return y instanceof f?y:new f(function(d){d(y)})}return new(f||(f=Promise))(function(y,d){function g(I){try{p(k.next(I))}catch(x){d(x)}}function v(I){try{p(k.throw(I))}catch(x){d(x)}}function p(I){I.done?y(I.value):b(I.value).then(g,v)}p((k=k.apply(c,m||[])).next())})},l=O&&O.__generator||function(c,m){var f={label:0,sent:function(){if(y[0]&1)throw y[1];return y[1]},trys:[],ops:[]},k,b,y,d;return d={next:g(0),throw:g(1),return:g(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function g(p){return function(I){return v([p,I])}}function v(p){if(k)throw new TypeError("Generator is already executing.");for(;f;)try{if(k=1,b&&(y=p[0]&2?b.return:p[0]?b.throw||((y=b.return)&&y.call(b),0):b.next)&&!(y=y.call(b,p[1])).done)return y;switch(b=0,y&&(p=[p[0]&2,y.value]),p[0]){case 0:case 1:y=p;break;case 4:return f.label++,{value:p[1],done:!1};case 5:f.label++,b=p[1],p=[0];continue;case 7:p=f.ops.pop(),f.trys.pop();continue;default:if(y=f.trys,!(y=y.length>0&&y[y.length-1])&&(p[0]===6||p[0]===2)){f=0;continue}if(p[0]===3&&(!y||p[1]>y[0]&&p[1]<y[3])){f.label=p[1];break}if(p[0]===6&&f.label<y[1]){f.label=y[1],y=p;break}if(y&&f.label<y[2]){f.label=y[2],f.ops.push(p);break}y[2]&&f.ops.pop(),f.trys.pop();continue}p=m.call(c,f)}catch(I){p=[6,I],b=0}finally{k=y=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}};Object.defineProperty(a,"__esModule",{value:!0}),a.Header=a.Track=a.Midi=void 0;var s=de(),n=z(),e=ce(),t=Se(),u=(function(){function c(m){var f=this,k=null;if(m){var b=m instanceof ArrayBuffer?new Uint8Array(m):m;k=(0,s.parseMidi)(b),k.tracks.forEach(function(y){var d=0;y.forEach(function(g){d+=g.deltaTime,g.absoluteTime=d})}),k.tracks=r(k.tracks)}this.header=new n.Header(k),this.tracks=[],m&&(this.tracks=k.tracks.map(function(y){return new e.Track(y,f.header)}),k.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return c.fromUrl=function(m){return h(this,void 0,void 0,function(){var f,k;return l(this,function(b){switch(b.label){case 0:return[4,fetch(m)];case 1:return f=b.sent(),f.ok?[4,f.arrayBuffer()]:[3,3];case 2:return k=b.sent(),[2,new c(k)];case 3:throw new Error("Could not load '".concat(m,"'"))}})})},Object.defineProperty(c.prototype,"name",{get:function(){return this.header.name},set:function(m){this.header.name=m},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"duration",{get:function(){var m=this.tracks.map(function(f){return f.duration});return Math.max.apply(Math,m)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"durationTicks",{get:function(){var m=this.tracks.map(function(f){return f.durationTicks});return Math.max.apply(Math,m)},enumerable:!1,configurable:!0}),c.prototype.addTrack=function(){var m=new e.Track(void 0,this.header);return this.tracks.push(m),m},c.prototype.toArray=function(){return(0,t.encode)(this)},c.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(m){return m.toJSON()})}},c.prototype.fromJSON=function(m){var f=this;this.header=new n.Header,this.header.fromJSON(m.header),this.tracks=m.tracks.map(function(k){var b=new e.Track(void 0,f.header);return b.fromJSON(k),b})},c.prototype.clone=function(){var m=new c;return m.fromJSON(this.toJSON()),m},c})();a.Midi=u;var o=ce();Object.defineProperty(a,"Track",{enumerable:!0,get:function(){return o.Track}});var i=z();Object.defineProperty(a,"Header",{enumerable:!0,get:function(){return i.Header}});function r(c){for(var m=[],f=0;f<c.length;f++)for(var k=m.length,b=new Map,y=Array(16).fill(0),d=0,g=c[f];d<g.length;d++){var v=g[d],p=k,I=v.channel;if(I!==void 0){v.type==="programChange"&&(y[I]=v.programNumber);var x=y[I],F="".concat(x," ").concat(I);b.has(F)?p=b.get(F):(p=k+b.size,b.set(F,p))}m[p]||m.push([]),m[p].push(v)}return m}})(O)),O}var Fe=Ce();let he=null;async function Q(){return he||=await navigator.requestMIDIAccess({sysex:!1}),he}async function Be(){const a=await Q();return Array.from(a.outputs.values())}function Pe(a,h,l){const s=performance.now();let n=0;const e=120;let t=0;function u(o){const i=o-s;for(;n<h.length&&h[n].timeMs<=i+e;){const r=h[n++];a.send(r.bytes,s+r.timeMs)}n<h.length?t=requestAnimationFrame(u):l?.()}return t=requestAnimationFrame(u),()=>cancelAnimationFrame(t)}function Ne(a){for(let h=0;h<16;h++)a.send([176|h,123,0])}function Ee(a,h){const l=6e4/h/24;a.send([250]);const s=setInterval(()=>a.send([248]),l);return()=>{clearInterval(s),a.send([252])}}function _e(a,h=0,l=60,s=100,n=300){a.send([144|h,l,s]),setTimeout(()=>a.send([128|h,l,64]),n)}function qe(a,h=0){const l=[];for(const s of a){const n=s.time*1e3,e=(s.time+s.duration)*1e3;l.push({timeMs:n,bytes:[144|h,s.midi,Math.round(s.velocity*127)]}),l.push({timeMs:e,bytes:[128|h,s.midi,64]})}return l.sort((s,n)=>s.timeMs-n.timeMs)}function je(a,h){const{bpm:l,rateDiv:s,octaves:n,gate:e,lengthBeats:t,channel:u,mode:o}=h,i=[...a].sort((b,y)=>b-y),r=o==="down"?i.slice().reverse():o==="updown"?[...i,...i.slice().reverse().slice(1,-1)]:o==="random"?i.slice().sort(()=>Math.random()-.5):i,m=6e4/l/(s/4),f=Math.floor(t*(s/4)),k=[];for(let b=0;b<f;b++){const y=r[b%r.length]+12*Math.floor(b/r.length%n),d=b*m,g=m*Math.max(.05,Math.min(1,e));k.push({timeMs:d,bytes:[144|u,y,100]}),k.push({timeMs:d+g,bytes:[128|u,y,64]})}return k}function Ae(a,h,l=0){let s=Array(h).fill(0).map(()=>[!0]),n=Array(Math.max(0,a-h)).fill(0).map(()=>[!1]);for(;n.length&&s.length>1;){const t=Math.min(s.length,n.length),u=[];for(let o=0;o<t;o++)u.push(s[o].concat(n[o]));s=u.concat(s.slice(t)),n=n.slice(t)}const e=s.flat();if(l){const t=(l%a+a)%a;return e.slice(a-t).concat(e.slice(0,a-t))}return e}function De(a,h){const{steps:l,pulses:s,rotate:n,bpm:e}=h,t=Ae(l,Math.min(s,l),n),u=6e4/e/4;return a.filter(o=>t[Math.floor(o.timeMs/u)%l])}const w=a=>document.getElementById(a),$=w("log"),P=a=>{$.textContent+=a+`
`,$.scrollTop=$.scrollHeight};let T=null,D=120,V=null,H=null,B=[];async function Ve(){try{await navigator.wakeLock?.request("screen")}catch{}}function M(a=15){try{navigator.vibrate?.(a)}catch{}}async function He(){const a=w("outSel");a.innerHTML="";const h=await Be();for(const l of h){const s=document.createElement("option");s.value=l.id,s.textContent=l.name||l.id,a.appendChild(s)}h[0]&&(a.value=h[0].id,T=h[0]),P(h.length?`MIDI outputs: ${h.map(l=>l.name).join(", ")}`:"No MIDI outputs.")}w("connectBtn").addEventListener("click",async()=>{await Q(),await He(),M(),Ve()});w("outSel").addEventListener("change",async a=>{T=(await Q()).outputs.get(a.target.value)||null,M()});w("testBtn").addEventListener("click",()=>{T&&(_e(T,0,60,110,250),M())});w("bpm").addEventListener("change",a=>{D=Number(a.target.value)||120,M()});w("clockBtn").addEventListener("click",()=>{T&&(V?.(),V=Ee(T,D),P("Clock started"),M())});w("stopBtn").addEventListener("click",()=>{V?.(),V=null,H?.(),H=null,T&&Ne(T),P("Stopped"),M()});w("playBtn").addEventListener("click",()=>{!T||!B.length||(H?.(),H=Pe(T,B,()=>P("Playback finished")),P(`Playing ${B.length} events…`),M())});w("file").addEventListener("change",async a=>{const h=a.target.files?.[0]??null;if(!h)return;const l=new Uint8Array(await h.arrayBuffer()),s=new Fe.Midi(l),n=qe(s.tracks.flatMap(b=>b.notes),0),e=[...new Set(s.tracks[0]?.notes.map(b=>b.midi)??[60,64,67])].sort((b,y)=>b-y),t=Number(document.getElementById("arpRate").value),u=Number(document.getElementById("arpOct").value),o=Number(document.getElementById("arpGate").value),i=document.getElementById("arpMode").value,r=Number(document.getElementById("eSteps").value),c=Number(document.getElementById("ePulses").value),m=Number(document.getElementById("eRotate").value),f=je(e,{bpm:D,rateDiv:t,octaves:u,gate:o,lengthBeats:8,channel:0,mode:i});B=[...De(n,{steps:r,pulses:c,rotate:m,bpm:D}),...f].sort((b,y)=>b.timeMs-y.timeMs),document.getElementById("fileInfo").textContent=`${h.name}: ${B.length} events ready`,P(`Loaded ${h.name} → ${B.length} events`),M()});let G=null;const K=w("installBtn");window.addEventListener("beforeinstallprompt",a=>{a.preventDefault(),G=a,K.removeAttribute("hidden")});K.addEventListener("click",async()=>{M(),G?.prompt(),G=null,K.setAttribute("hidden","true")});"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(()=>{})});
